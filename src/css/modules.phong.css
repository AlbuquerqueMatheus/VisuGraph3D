@layer components {
.phong-main { display: grid; grid-template-columns: 320px 1fr; grid-template-areas: "controls viewer" "controls side"; gap: 20px; align-items: start; }


.phong-controls { grid-area: controls; background: var(--sidebar-bg); padding: 20px; border-radius: 8px; border: 1px solid var(--accent-color); box-shadow: var(--shadow-1); }
.phong-controls .row { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 10px; align-items: center; }
.phong-geometry-group, .phong-slider-group { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }


.phong-title { margin-top: 20px; margin-bottom: 10px; font-size: 1.1rem; border-bottom: 1px solid var(--accent-hover); padding-bottom: 5px; }
.slider-label { min-width: 40px; }
.slider-value { width: 36px; text-align: right; font-variant-numeric: tabular-nums; }


#phong-viewer { grid-area: viewer; width: 100%; height: clamp(360px, 48vh, 520px); background: #111; border: 2px solid var(--accent-color); border-radius: 8px; position: relative; overflow: hidden; contain: layout paint size; }
#phong-viewer canvas { display: block; }
#phong-viewer .phong-legend { position: absolute; top: 8px; left: 8px; background: rgba(0,0,0,.55); border: 1px solid var(--accent-color); border-radius: 6px; padding: 6px 8px; font-size: .85rem; line-height: 1.25; pointer-events: none; }
#phong-viewer .phong-legend div { display: flex; align-items: center; gap: 6px; margin: 2px 0; }
#phong-viewer .phong-legend span { width: 10px; height: 10px; display: inline-block; border-radius: 2px; }


.phong-label { font: 12px ui-monospace, Menlo, monospace; background: rgba(0,0,0,.6); padding: 2px 6px; border-radius: 6px; border: 1px solid currentColor; color: #fff; text-shadow: 0 1px 2px rgba(0,0,0,.6); pointer-events: none; }


.phong-side { grid-area: side; width: 100%; box-sizing: border-box; padding: 12px; background: var(--sidebar-bg); border: 1px solid var(--accent-color); border-radius: 8px; display: grid; grid-template-columns: 1fr auto; grid-template-rows: auto 1fr; grid-template-areas: "formula formula" "numbers explain"; gap: 12px; align-items: start; overflow: hidden; }
.phong-formula { grid-area: formula; width: 100%; display: block; background: #111; border: 1px solid #444; border-radius: 6px; height: clamp(120px, 14vh, 180px); }
.numbers { grid-area: numbers; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, monospace; font-size: .95rem; line-height: 1.5; }
.numbers .hidden { display: none; }


.btn-explain { grid-area: explain; align-self: start; justify-self: end; padding: 10px 20px; background: var(--accent-color); border: none; border-radius: 6px; cursor: pointer; color: #000; transition: background .2s; }
.btn-explain:hover { background: var(--accent-hover); }


@media (max-width: 900px) {
.phong-main { grid-template-columns: 1fr; grid-template-areas: "controls" "viewer" "side"; }
.phong-side { grid-template-columns: 1fr; grid-template-areas: "formula" "numbers" "explain"; }
.btn-explain { justify-self: start; }
}
}